#!/usr/bin/env php 
<?php

function findbin($bin)
{
    $paths = explode(":",getenv('PATH'));
    foreach( $paths as $path ) {
        if( file_exists( $path . DIRECTORY_SEPARATOR . $bin ) ) {
            return $path . DIRECTORY_SEPARATOR . $bin;
        }
    }
}

function php_option_to_args($options) {
    $args = array();
    foreach($options as $key => $value) {
        $args[] = "-d";
        $args[] = escapeshellarg("$key=$value");
    }
    return $args;
}

require "EXTUnit/TestSuite.php";
require "EXTUnit.php";

$longopts  = array(
    "gdb", // for gdb
);
$options = getopt(array(), $longopts);

// remove --gdb options from argv
if ( isset($options['gdb']) ) {
    $pos = array_search('--gdb',$argv);
    array_splice($argv,$pos,1);
}


$workdir = getcwd();
$php = findbin('php');
$phpunit = findbin('phpunit');
$extensionName = '';
$script = array_shift( $argv );

// write gdbinit
$success = system('make > /dev/null') !== false;
if (!$success) {
    exit();
}

$extunit = new EXTUnit("extension.xml");

if ( isset($options['gdb']) ) {


} else {

}









